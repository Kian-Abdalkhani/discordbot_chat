# Discord Bot with LLM Integration

A Discord bot that integrates with Ollama to provide AI-powered chat responses. The bot responds to mentions with intelligent replies generated by a local LLM.

## Features

- **Discord Integration**: Responds to mentions in Discord channels
- **LLM Integration**: Uses Ollama for AI-powered responses
- **Docker Support**: Easy deployment with Docker and Docker Compose
- **Comprehensive Testing**: Full test suite with pytest
- **Logging**: Structured logging for monitoring and debugging

## Project Structure

```
discordbot_chat/
├── src/
│   ├── __init__.py
│   ├── main.py              # Application entry point
│   ├── bot.py               # Discord bot implementation
│   ├── bot_llm.py           # LLM integration with Ollama
│   └── utils/
│       ├── __init__.py
│       └── logging.py       # Logging configuration
├── tests/
│   ├── __init__.py
│   ├── conftest.py          # Test configuration
│   ├── test_bot_llm.py      # LLM functionality tests
│   ├── test_discord_bot.py  # Discord bot tests
│   └── test_main.py         # Main application tests
├── Dockerfile               # Docker container configuration
├── docker-compose.yml       # Docker Compose setup
├── pyproject.toml          # Python project configuration
└── README.md               # This file
```

## Prerequisites

- Python 3.13+
- Discord Bot Token
- Ollama installed and running locally
- Docker and Docker Compose (for containerized deployment)

## Setup

### 1. Clone the Repository

```bash
git clone <repository-url>
cd discordbot_chat
```

### 2. Environment Configuration

Create a `.env` file in the project root:

```env
BOT_TOKEN=your_discord_bot_token_here
OLLAMA_API_URL=http://127.0.0.1:11434
```

### 3. Discord Bot Setup

1. Go to the [Discord Developer Portal](https://discord.com/developers/applications)
2. Create a new application
3. Go to the "Bot" section
4. Create a bot and copy the token
5. Enable the following bot permissions:
   - Send Messages
   - Read Message History
   - Use Slash Commands
6. Enable the following privileged gateway intents:
   - Message Content Intent
   - Server Members Intent

### 4. Ollama Setup

1. Install Ollama from [ollama.ai](https://ollama.ai)
2. Pull the required model:
   ```bash
   ollama pull boug_bot:HC
   ```
   Note: You can change the model in `src/bot_llm.py` by modifying the `OLLAMA_MODEL` variable
3. Ensure Ollama is running:
   ```bash
   ollama serve
   ```

## Installation

### Option 1: Local Development

1. Install dependencies:
   ```bash
   pip install -e .
   ```

2. Run the bot:
   ```bash
   python src/main.py
   ```

### Option 2: Docker Deployment

1. Build and run with Docker Compose:
   ```bash
   docker-compose up --build
   ```

## Usage

1. Invite the bot to your Discord server using the OAuth2 URL from the Discord Developer Portal
2. Mention the bot in any channel: `@YourBot Hello, how are you?`
3. The bot will respond with an AI-generated message from Ollama

## Testing

Run the test suite:

```bash
# Run all tests
pytest

# Run with verbose output
pytest -v

# Run specific test file
pytest tests/test_bot_llm.py

# Run with coverage
pytest --cov=src
```

### Test Coverage

The project includes comprehensive tests for:
- **LLM Integration**: Testing Ollama API calls, error handling, and response processing
- **Discord Bot**: Testing event handlers, message processing, and bot creation
- **Main Application**: Testing application startup, configuration, and error handling

## Configuration

### Environment Variables

- `BOT_TOKEN`: Your Discord bot token (required)
- `OLLAMA_API_URL`: Ollama API endpoint (default: http://127.0.0.1:11434)

### LLM Model Configuration

To change the LLM model, edit `src/bot_llm.py`:

```python
OLLAMA_MODEL: str = "your_preferred_model"
```

## Development

### Code Structure

- **main.py**: Application entry point, handles configuration and bot startup
- **bot.py**: Discord bot implementation with event handlers
- **bot_llm.py**: LLM integration, handles communication with Ollama
- **utils/logging.py**: Logging configuration

### Adding New Features

1. Create feature branch
2. Add implementation
3. Add corresponding tests
4. Update documentation
5. Submit pull request

### Running Tests During Development

```bash
# Run tests in watch mode
pytest --watch

# Run specific test
pytest tests/test_bot_llm.py::test_bot_response_blank -v
```

## Troubleshooting

### Common Issues

1. **Bot not responding to mentions**
   - Ensure the bot has proper permissions in the Discord server
   - Check that Message Content Intent is enabled
   - Verify the bot token is correct

2. **Ollama connection errors**
   - Ensure Ollama is running: `ollama serve`
   - Check the OLLAMA_API_URL environment variable
   - Verify the model is available: `ollama list`

3. **Import errors**
   - Ensure you're running from the project root directory
   - Check that all dependencies are installed

### Logging

The bot uses structured logging. Check the console output for detailed information about:
- Bot connection status
- Message processing
- LLM API calls
- Error conditions

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests for new functionality
5. Ensure all tests pass
6. Submit a pull request

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Support

For issues and questions:
1. Check the troubleshooting section
2. Review the test files for usage examples
3. Create an issue in the repository

## Changelog

### v0.1.0
- Initial release
- Discord bot with mention-based responses
- Ollama LLM integration
- Docker support
- Comprehensive test suite